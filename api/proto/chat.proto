syntax = "proto3";

package chat;

import "common.proto";

option go_package = "github.com/magomedcoder/legion/api/pb/chatpb;chatpb";

service ChatService {
  rpc CreateChat(CreateChatRequest) returns (Chat);

  rpc GetChats(GetChatsRequest) returns (GetChatsResponse);

  rpc SendMessage(SendMessageRequest) returns (Message);

  rpc GetHistory(GetHistoryRequest) returns (GetHistoryResponse);

  rpc DeleteMessages(DeleteMessagesRequest) returns (DeleteMessagesResponse);
}

message Chat {
  common.Peer peer = 1;
  int64 updated_at = 2;
  int32 unread_count = 3;
}

message Message {
  int64 id = 1;
  common.Peer peer = 2;
  common.Peer from_peer = 3;
  string content = 4;
  int64 created_at = 5;
  bool is_read = 6;
}

message CreateChatRequest {
  string user_id = 1;
}

message GetChatsRequest {}

message GetChatsResponse {
  repeated Chat chats = 1;
  repeated common.User users = 2;
}

message SendMessageRequest {
  common.Peer peer = 1;
  string content = 2;
}

message GetHistoryRequest {
  common.Peer peer = 1;
  int64 message_id = 2;
  int64 limit = 3;
}

message GetHistoryResponse {
  repeated Message messages = 1;
  repeated common.User users = 2;
}

message DeleteMessagesRequest {
  repeated int64 message_ids = 1;
  bool revoke = 2;
}

message DeleteMessagesResponse {}
